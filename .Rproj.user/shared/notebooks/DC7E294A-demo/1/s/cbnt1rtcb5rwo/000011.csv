"0",""
"0",""
"0","# define feature and grid (based onf feature class)"
"0","feat <- ""bm02"""
"0",""
"0","feat_cat <- data_prep %>% dplyr::pull(!!feat) %>% class()"
"0","n_grid <- 10"
"0",""
"0",""
"0","if (feat_cat == ""numeric"") {"
"0","  feat_range <- data_prep %>%"
"0","    dplyr::pull(!!feat) %>%"
"0","    range()"
"0","  "
"0","  feat_grid <-"
"0","    seq(from = feat_range[1],"
"0","        to = feat_range[2],"
"0","        length.out = n_grid)"
"0","  "
"0","} else {"
"0","  feat_grid <- data_prep %>%"
"0","    dplyr::pull(!!feat) %>%"
"0","    levels()"
"0","}"
"0",""
"0","# replace corresponding feature values with grid values"
"0","data_sets <-  purrr::map(feat_grid,"
"0","                         ~ data_prep %>% dplyr::mutate(dplyr::across("
"0","                           tidyselect::all_of(feat),"
"0","                           .fns = function(y)"
"0","                             .x"
"0","                         )))"
"0",""
"0",""
"0","# calculate predictions for specified time points ####"
"0","preds <- map("
"0","  data_sets,"
"0","  ~ ranger:::predict.ranger(rf_model, data = .x)$survival %>%"
"0","    tibble::as_tibble() %>%"
"0","    dplyr::select(all_of(time_points))"
"0",")"
"0","# calculate PDPs (average (survival probability) for each feature grid value per timepoint)"
"0","pdp_data <- purrr::map2("
"0","  preds,"
"0","  feat_grid,"
"0","  ~ .x %>%"
"0","    apply(2, mean) %>%"
"0","    tibble::enframe(value = "".value"", name = ""time_id"") %>%"
"0","    dplyr::mutate(time_id = stringr::str_replace(time_id, ""V"", """") %>% as.numeric()) %>%"
"0","    dplyr::mutate(feat_val1 = .y)"
"0",") %>%"
"0","  dplyr::bind_rows() %>%"
"0","  dplyr::rename({"
"0","    {"
"0","      feat"
"0","    }"
"0","  } := feat_val1)"
"0",""
